<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('../partials/header1.ejs') %>
    <link rel="stylesheet" href="/public/css/admin.css" />
</head>
<body>
    <header>
        <%- include('../partials/navbar-admin.ejs') %>
    </header>

    <div class="admin-container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <h2>Admin Menu</h2>
            <a href="/admin/view-users" class="menu-item">User Management</a>
            <a href="/admin/view-menu" class="menu-item">Menu Items</a>
            <a href="/admin/view-tables" class="menu-item">Table Management</a>
            <a href="/admin/view-dietary" class="menu-item">Dietary Preferences</a>
            <a href="/admin/view-faqs" class="menu-item active">FAQs</a>
            <a href="/admin/admin-report" class="menu-item">Reports</a>
        </nav>

        <!-- Main content -->
        <section class="main-content">
            <h1>Frequently Asked Questions</h1>            
            <!-- Toolbar -->
            <div class="toolbar">
                <input id="userSearch" class="search-input" type="search"
                       placeholder="Search by FAQ">
            </div>

            <div class="mb-3">
                <a href="/admin/faqs/new" class="btn btn-add"><i class="fa-solid fa-plus"></i> Add FAQ</a>
            </div>
            <!-- FAQs table -->
            <table class="users-table" id="faqsTable">
                <thead>
                    <tr>
                        <th data-col="id">ID &#x25B2;</th>
                        <th data-col="faqTitle">Title</th>
                        <th data-col="faqDetail">Detail</th>
                        <th style="width: 250px;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% faqs.forEach(faq => { %>
                        <tr>
                            <td><%= faq.id %></td>
                            <td><%= faq.faqTitle %></td>
                            <td><%= faq.faqDetail %></td>
                            <td>
                                <a href="/admin/faqs/<%= faq.id %>/edit" class="btn btn-edit">Edit</a>

                                <form action="/admin/faqs/<%= faq.id %>?_method=DELETE"
                                        method="POST"
                                        style="display:inline"
                                        onsubmit="return confirm('Delete <%= faq.faqTitle %>?');">
                                    <button class="btn btn-delete">Delete</button>
                                </form>
                            </td>
                        </tr>
                    <% }) %>

                </tbody>
            </table>
        </section>
    </div>

    <!-- Client‑side search + simple column sorting -->
    <script>
        (function () {
            const rows   = [...document.querySelectorAll('#faqsTable tbody tr')];
            const search = document.getElementById('userSearch');

            /* ---- live search ---- */
            search.addEventListener('input', e => {
                const q = e.target.value.toLowerCase();
                rows.forEach(row => {
                    row.style.display = row.innerText.toLowerCase().includes(q) ? '' : 'none';
                });
            });

            /* ---- basic sort ---- */
            let asc = true;
            document.querySelectorAll('#faqsTable thead th[data-col]').forEach(th => {
                th.addEventListener('click', () => {
                    const col = th.dataset.col;
                    asc = !asc;
                    document.querySelectorAll('#faqsTable thead th[data-col]').forEach(h => {
                        h.innerHTML = h.innerHTML.replace(' ▲', '').replace(' ▼', '');
                    });
                    th.innerHTML = th.textContent + (asc ? ' ▲' : ' ▼');

                    rows.sort((a, b) => {
                        const ta = a.querySelector('td:nth-child(' + (th.cellIndex + 1) + ')').innerText;
                        const tb = b.querySelector('td:nth-child(' + (th.cellIndex + 1) + ')').innerText;
                        return asc ? ta.localeCompare(tb, undefined, {numeric: true}) :
                                     tb.localeCompare(ta, undefined, {numeric: true});
                    });
                    const tbody = th.closest('table').querySelector('tbody');
                    rows.forEach(r => tbody.appendChild(r));
                });
            });
        })();
    </script>
</body>
</html>